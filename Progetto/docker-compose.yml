version: "3"

services:
    WebServer1:
        build: Dockerfiles/webserver/.
        image: webserver
        container_name: WS1
        networks:
            - Internal
        depends_on:
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "WS1"
    WebServer2:
        build: Dockerfiles/webserver/.
        image: webserver
        container_name: WS2
        networks:
            - Internal
        depends_on:
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "WS2"
    WebServer3:
        build: Dockerfiles/webserver/.
        image: webserver
        container_name: WS3
        networks:
            - Internal
        depends_on:
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "WS3"
    WebServer4:
        build: Dockerfiles/webserver/.
        image: webserver
        container_name: WS4
        networks:
            - Internal
        depends_on:
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "WS4"
    LoadBalancer:
        build: Dockerfiles/load-balancer/.
        image: loadbalancer
        container_name: LB
        networks:
            - Internal
            - External
        ports:
            - "80:80"
        depends_on:
            - WebServer1
            - WebServer2
            - WebServer3
            - WebServer4
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "LB"
    Syslogserver:
        build: Dockerfiles/rsyslog/.
        image: syslogserver
        container_name: Syslog
        hostname: syslog
        restart: always
        volumes:
            - "/Users/alessandrobenetton/OneDrive - CÃ¡ Foscari - Virtual LABs/University/III_Anno/CT0157-Laboratorio_Amministrazione_Sistema/LAS2021-NGINX-LoadBalancer/Progetto/logs:/var/log"
        ports:
            - 514:514
            - 514:514/udp
        cap_add:
            - SYSLOG
    Monitor:
        container_name: MON
        build: Dockerfiles/monitor/.
        image: monitor
        stdin_open: true
        tty: true
        networks:
            - Internal
            - External
        depends_on:
            - Syslogserver
        logging:
            driver: syslog
            options:
                syslog-address: "tcp://localhost:514"
                tag: "MON"

networks:
    Internal:
        internal: true
    External: